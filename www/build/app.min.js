var App={};App.error=function(r){console.error("Error:",r)},App.getTime=function(){var r=new Date;return r.getTime()},App.getTimer=function(){var r=App.getTime();return function(){return App.getTime()-r}};
$(function(){$(".dropdown-big .dropdown-toggle").on("click",function(){var o=$(this).parents(".dropdown").first();o.toggleClass("open"),o.parents("header").toggleClass("hover")}),$(".ul-tab a").click(function(o){o.preventDefault(),$(this).tab("show")})});
function transliterate(e){e=String(e);var a=" ",i={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","©":"(c)","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Ş":"S","İ":"I","Ç":"C","Ü":"U","Ö":"O","Ğ":"G","ş":"s","ı":"i","ç":"c","ü":"u","ö":"o","ğ":"g","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ó":"o","Ś":"S","Ź":"Z","Ż":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ó":"o","ś":"s","ź":"z","ż":"z","Ā":"A","Č":"C","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Š":"S","Ū":"u","Ž":"Z","ā":"a","č":"c","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","š":"s","ū":"u","ž":"z"};for(var o in i)e=e.replace(RegExp(o,"g"),i[o]);var g="undefined"==typeof XRegExp?RegExp("[^a-z0-9]+","ig"):XRegExp("[^\\p{L}\\p{N}]+","ig");return e=e.replace(g,a),e=e.replace(RegExp("["+a+"]{2,}","g"),a),e=e.replace(RegExp("(^"+a+"|"+a+"$)","g"),"")}
$(function(){var i=$("[data-exercise]");if(i.length){App.onInactive.add(function(){i.find("[name=inactivity]").val(!0)});var n=App.getTimer("exercise");i.on("submit",function(){$(this).find("[name=time]").val(n())});var t=i.find("[data-hint]").hide().toArray();$("[data-show-hint]").click(function(){i.find("[name=hint]").val(!0),$(t.shift()).show(),t.length||$(this).hide()})}});
$(function(){$("[data-toggle]").click(function(t){t.preventDefault(),$(this).tab("show")}),$("[data-toggle]:first").tab("show")});
App._idleSince=null,App._resetIdleTime=function(){App._idleSince=App.getTime()},App._checkIdle=function(){if(null!==App._idleSince){var e=App.getTime()-App._idleSince;e>6e4&&(App.onInactive.fire(),App._idleSince=null)}},App._resetIdleTime(),App.onInactive=$.Callbacks(),$(document).mousemove(App._resetIdleTime),$(document).keypress(App._resetIdleTime),setInterval(App._checkIdle,250);
$(function(){$("time").timeago()});
window.location.hash&&"#_=_"==window.location.hash&&(window.location.hash=""),window.history.replaceState&&(l=window.location.toString(),uri=l.indexOf("_fid="),-1!=uri&&(uri=l.substr(0,uri)+l.substr(uri+10),("?"==uri.substr(uri.length-1)||"&"==uri.substr(uri.length-1))&&(uri=uri.substr(0,uri.length-1)),window.history.replaceState("",document.title,uri)));
!function(){if($form=$("#frm-blueprintEditor-form"),$form.length){var n={};n.saveHook=function(n,a,r){var e=function(){for(var e in r)n[e]=r[e].val();a.val(JSON.stringify(n))};for(var t in r)r[t].on("change",e);e()},n.render=function(a,r){var e=$("<div></div>").text("type: "+a.type);r.hide(),r.after(e);var t="render"+a.type.charAt(0).toUpperCase()+a.type.slice(1);n[t](a,e,r)},n.renderInteger=function(a,r,e){var t=$('<input type="number" class="form-control">').val(a.min),i=$('<input type="number" class="form-control">').val(a.max);r.append(t).append(i),n.saveHook(a,e,{min:t,max:i})},n.renderPlural=function(a,r,e){var t={},i=["count","one","few","many"];for(var o in i){var f=i[o];t[f]=$('<input class="form-control">').val(a[f]),r.append(t[f])}n.saveHook(a,e,t)},n.renderList=function(n,a,r){var e={};for(var t in n.list){e[t]=$('<input class="form-control">').val(n.list[t]),a.append(e[t]);var i=function(){n.list=[];for(var a in e)n.list.push(e[a].val());r.val(JSON.stringify(n))};e[t].on("change",i),i()}r.val(JSON.stringify(n))},$form.find("[data-definition]").each(function(a,r){var e=JSON.parse($(r).val());n.render(e,$(r))});var a=$form.find("[data-definitions]");$form.find("[data-add-type]").on("click",function(){var r=$(this).data("add-type"),e=a.find("[data-definition]").length,t=$('<input name="vars['+e+'][name]" class="form-control">'),i=$('<input name="vars['+e+'][definition]" data-definition class="form-control">');a.append(t).append(i);var o={type:r};"integer"===r?(o.min=0,o.max=100):"list"===r?o.list=[]:"plural"===r&&(o={type:r,count:"<eval></eval>",one:"",few:"",many:""}),n.render(o,i)});var r,e,t;a.find("[data-var-remove]").click(function(n){t&&t.remove();var i=$(n.target),o=a.find('[data-var-id="'+i.data("var-remove")+'"]');e=$("<div></div>"),o.after(e),t=$('<a class="btn btn-link"></a>').text(i.data("label-undo")).on("click",function(){e.after(r),e.remove(),t.remove()}),o.after(t),o.detach(),r=o})}}();
$(function(){if($form=$("#frm-linkStudentsForm-form"),$form.length){var n=$form.find("input[type=email]").last().clone();$form.countEmpty=function(){var n=0;return $(this).find("input[type=email]").each(function(t,o){$(o).val().trim()||n++}),n},$form.on("change keyup paste","input[type=email]",function(){if(console.log($form.countEmpty()),$form.countEmpty()<1){var t=n.clone(),o=$form.find("input[type=email]").length;t.attr("name","emails["+o+"][email]"),$form.find(".form-group").append(t)}})}});
$(function(){$form=$("#frm-loginForm-form"),$form.length&&$form.find('input[name="email"]').on("change paste keyup",function(){var e=$("[data-password-reset]"),a=e.data("password-reset")+"?email="+encodeURIComponent($(this).val());e.attr("href",a)})});
$(function(){$form=$("#frm-registrationForm-form"),$form.length&&($form.find('input[name="name"]').on("change paste keyup",function(){/ov(á|a)\s*$/.test($(this).val())&&$("#frm-registrationForm-form-gender-female").prop("checked",!0)}),$form.find('input[name="password"]').on("change paste keyup",function(){var n=[],a=$form.find('input[name="email"]').val();n.push(a),n.push.apply(n,a.split("@"));var r=$form.find('input[name="name"]').val();n.push(r),n.push.apply(n,r.split(" "));var p=transliterate(r);n.push(p),n.push.apply(n,p.split(" "));var e=zxcvbn($(this).val(),n);$(this).parents(".form-group").toggleClass("has-warning",e.entropy<30)}))});
!function(){var t={top:20,right:20,bottom:30,left:40},a=960-t.left-t.right,r=350-t.top-t.bottom,n=d3.scale.ordinal().rangeRoundBands([0,a],.1),e=d3.scale.linear().range([r,0]),o=d3.svg.axis().scale(n).orient("bottom"),c=d3.svg.axis().scale(e).orient("left"),l=d3.select("body").append("svg").attr("width",a+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),s=function(t){return t.x=t[0],t.y=+t[1],t.correct=t[2],t.score=t[3],t},i=d3.svg.line().x(function(t){return n(t.x)+13}).y(function(t){return e(50*t.score)});$(".column-chart").each(function(){$chart=$(this),$.ajax({url:$chart.data("url"),success:function(t){t=t.map(s),n.domain(t.map(function(t){return t.x})),e.domain([0,d3.max(t,function(t){return t.y})]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),l.append("g").attr("class","y axis").call(c).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text($chart.data("y-title")),l.selectAll(".bar").data(t).enter().append("rect").attr("class",function(t){return"column "+(t.correct?"column-correct":"column-wrong")}).attr("x",function(t){return n(t.x)}).attr("width",n.rangeBand()).attr("y",function(t){return e(t.y)}).attr("height",function(t){return r-e(t.y)}),l.append("path").datum(t).attr("class","line").attr("d",i)}})})}();
!function(){$comments=$("[js-comments]"),$comments.length&&($input=$("#frm-comments-commentForm-form-text"),$replyTo=$("#frm-comments-commentForm-form-replyTo"),$comments.find("[js-comments-reply]").on("click",function(){return $input.val($(this).data("author")+": "),$replyTo.val($(this).data("reply-to")),$input.focus(),!1}))}();
$(function(){var t;$(".editable").each(function(){var a=new MediumEditor($(this),{buttons:["bold","italic","anchor","header1"],disableDoubleReturn:!0});$(this).on("input",function(){var e=a.serialize()[$(this).attr("id")].value;t&&t.abort(),t=$.ajax({url:$(this).data("url-save"),data:{text:e},type:"POST",success:function(t){t.saved||App.error(arguments)},error:function(){App.error(arguments)}})})})});
App.elasticSearch=new $.es.Client({hosts:"@@domain.elastic"}),App.autocomplete=function(t,e){App.elasticSearch.search({index:"khanovaskola",type:"Video,Blueprint",body:{query:{match:{title:t}},highlight:{pre_tags:["<strong>"],post_tags:["</strong>"],fields:{title:{number_of_fragments:0}}}}}).then(function(t){var i=[];$.each(t.hits.hits,function(t,e){i.push({id:e._id,value:e._source.title,highlit:"title"in e.highlight?e.highlight.title[0]:e._source.title})}),e(i)})},$(function(){$("#frm-search-form-query").typeahead({hint:!0,highlight:!1,minLength:1},{name:"states",templates:{suggestion:function(t){return"<p>"+t.highlit+"</p>"}},source:function(t,e){App.autocomplete(t,function(t){e(t)})}})});
!function(){if($video=$("#video"),$video.length){var e,i,o=0,a=0,n=0,t=[],c=function(i,o,a){var n=function(){var n=$video.data("url-"+i).replace(encodeURIComponent("{viewId}"),e);console.log(n),$.ajax(n,{data:o,success:a})};if(t.push(n),e){var c=t;t=[],$.each(c,function(e,i){i()})}};sublime.ready(function(){var t=sublime.player($video.attr("id"));t.on("start",function(){console.info("video:start"),i=App.getTimer("video:realtime"),$.ajax($video.data("url-begin"),{success:function(i){e=i.viewId}})}),$(window).unload(function(){if(i){var e=n+i()/1e3;c("tick",{time:e,percent:e/t.duration()*100,furthest:a})}});var r,d;t.on("pause",function(){console.info("video:pause",t.playbackTime()),n+=i()/1e3,r=App.getTimer("video:pause"),d=t.playbackTime()}),t.on("play",function(){console.info("video:play",t.playbackTime()),r&&c("pause",{at:d,duration:r()/1e3}),i=App.getTimer("video:realtime")}),t.on("seek",function(){console.info("video:seek",t.playbackTime()),c("seek",{from:o,to:t.playbackTime()})});var p;t.on("timeUpdate",function(){console.info("video:timeUpdate",t.playbackTime());var e=t.playbackTime();if(2>e-o&&(o=e),o>a&&(a=o),!(p&&p()/1e3<20)){console.info("video:tick"),p=App.getTimer("video:tick");var r=n+i()/1e3;c("tick",{time:r,percent:r/t.duration()*100,furthest:a})}})})}}();
//# sourceMappingURL=app.min.js.map