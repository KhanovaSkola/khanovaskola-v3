#!/usr/bin/env php
<?php
#
# Run CodeSniffer on all staged files
#

$root = __DIR__ . '/../..';
$files = [];
exec(sprintf('cd %s; git diff --cached --name-only', escapeshellarg($root)), $files);

$args = [];
foreach ($files as $file)
{
	$path = "$root/$file";
	if (file_exists($path) && preg_match('~\.php$~', $path))
	{
		$args[] = escapeshellarg($path);
	}
}
$ret = 0;
if ($args)
{
	passthru(sprintf('php "vendor/bin/phpcs" --severity=1 -p --standard="tests/cs" %s', implode(' ', $args)), $ret);
}

exit($ret);
